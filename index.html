<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KromaMind | International Color Meaning Engine</title>
    <!-- Tailwind CSS for fluid layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --bg-color: #030617;
            --accent-color: #FF8201;
            --accent-hover: #e67500;
            --text-color: #FFFFFF;
            --card-bg: #0f172a;
            --border-color: #1e293b;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .accent-bg { background-color: var(--accent-color); }
        .accent-text { color: var(--accent-color); }
        
        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            transition: transform 0.2s ease, border-color 0.2s ease;
        }

        /* Mobile specific spacing and sizing */
        @media (max-width: 640px) {
            .glass-card { padding: 1rem; border-radius: 12px; }
            h1 { font-size: 1.25rem; }
            .btn-primary { width: 100%; justify-content: center; padding: 12px; }
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-primary:active { transform: scale(0.96); }

        /* Color Picker Customization */
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 8px; }

        /* Chart container responsiveness */
        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .chart-wrapper { height: 250px; }
        }

        /* Accessibility Vision Filters */
        .protanopia { filter: url('#protanopia-filter'); }
        .deuteranopia { filter: url('#deuteranopia-filter'); }
        .tritanopia { filter: url('#tritanopia-filter'); }
    </style>
</head>
<body class="min-h-screen pb-10">

    <!-- Filters for Accessibility -->
    <svg style="position: absolute; height: 0; width: 0;">
        <filter id="protanopia-filter"><feColorMatrix values="0.567,0.433,0,0,0 0.558,0.442,0,0,0 0,0.242,0.758,0,0 0,0,0,1,0"/></filter>
        <filter id="deuteranopia-filter"><feColorMatrix values="0.625,0.375,0,0,0 0.7,0.3,0,0,0 0,0.3,0.7,0,0 0,0,0,1,0"/></filter>
        <filter id="tritanopia-filter"><feColorMatrix values="0.95,0.05,0,0,0 0,0.433,0.567,0,0 0,0.475,0.525,0,0 0,0,0,1,0"/></filter>
    </svg>

    <!-- Global Header -->
    <header class="sticky top-0 z-40 w-full bg-[#030617]/80 backdrop-blur-md border-b border-slate-800">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="p-1.5 accent-bg rounded-lg">
                    <i data-lucide="palette" class="text-white w-5 h-5"></i>
                </div>
                <span class="font-bold text-lg tracking-tight hidden sm:inline">Kroma<span class="accent-text">Mind</span></span>
            </div>
            <div class="flex gap-2">
                <button onclick="exportReport()" class="btn-primary text-sm">
                    <i data-lucide="file-down" class="w-4 h-4"></i>
                    <span class="hidden xs:inline">Report</span>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pt-6">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- LEFT COLUMN: Controls -->
            <aside class="lg:col-span-4 space-y-6">
                <!-- Color Input Card -->
                <section class="glass-card p-5">
                    <h2 class="text-sm font-bold uppercase tracking-widest text-slate-500 mb-4 flex items-center gap-2">
                        <i data-lucide="settings-2" class="w-4 h-4"></i> Input Engine
                    </h2>
                    
                    <div class="flex items-center gap-4 mb-6">
                        <div class="relative group">
                            <input type="color" id="mainColorPicker" value="#FF8201" 
                                class="w-20 h-20 rounded-xl cursor-pointer bg-transparent border-2 border-slate-700 p-1">
                        </div>
                        <div class="flex-1 space-y-2">
                            <label class="text-xs text-slate-400">Hex Code</label>
                            <input type="text" id="hexInput" value="#FF8201" 
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-lg font-mono uppercase focus:border-orange-500 outline-none">
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-slate-400 mb-1.5 block">Industry Context</label>
                            <select id="industrySelect" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2.5 text-sm outline-none focus:ring-1 focus:ring-orange-500">
                                <option value="tech">Technology & AI</option>
                                <option value="luxury">Luxury & Fashion</option>
                                <option value="health">Healthcare & Wellness</option>
                                <option value="gaming">Gaming & Sports</option>
                            </select>
                        </div>
                        
                        <button id="aiSuggestBtn" class="w-full py-3 rounded-lg border border-indigo-500/30 bg-indigo-500/10 text-indigo-300 font-semibold text-sm flex items-center justify-center gap-2 hover:bg-indigo-500/20 transition-colors">
                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                            AI Color Strategy
                        </button>
                    </div>
                </section>

                <!-- Palette Summary Card -->
                <section class="glass-card p-5">
                    <h3 class="text-xs font-bold text-slate-500 uppercase mb-4">Harmony & Accessibility</h3>
                    <div id="paletteStrip" class="flex h-10 rounded-lg overflow-hidden mb-4 border border-slate-800"></div>
                    <div id="accessibilityCheck" class="space-y-3"></div>
                </section>
            </aside>

            <!-- RIGHT COLUMN: Analysis -->
            <div class="lg:col-span-8 space-y-6" id="captureArea">
                
                <!-- Psychology & Culture Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Psychology -->
                    <div class="glass-card p-6 flex flex-col h-full">
                        <div class="flex items-start justify-between mb-4">
                            <h3 class="text-lg font-bold">Psychology</h3>
                            <i data-lucide="brain" class="accent-text opacity-40 w-6 h-6"></i>
                        </div>
                        <div id="emotionalTags" class="flex flex-wrap gap-2 mb-4"></div>
                        <div id="meaningDescription" class="text-sm text-slate-300 leading-relaxed bg-slate-950/40 p-3 rounded-lg border border-slate-800 flex-1"></div>
                    </div>

                    <!-- Cultural Awareness -->
                    <div class="glass-card p-6">
                        <div class="flex items-start justify-between mb-4">
                            <h3 class="text-lg font-bold">Global Context</h3>
                            <i data-lucide="globe" class="accent-text opacity-40 w-6 h-6"></i>
                        </div>
                        <div id="culturalList" class="space-y-2.5"></div>
                        <div id="sensitivityAlert" class="mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 hidden">
                            <div class="flex gap-2 items-center text-red-400 text-xs font-bold uppercase">
                                <i data-lucide="shield-alert" class="w-4 h-4"></i> Sensitivity Note
                            </div>
                            <p id="alertText" class="text-xs text-red-200/80 mt-1"></p>
                        </div>
                    </div>
                </div>

                <!-- Intensity Profile -->
                <div class="glass-card p-6">
                    <h3 class="text-lg font-bold mb-6">Emotional Intensity Heatmap</h3>
                    <div class="chart-wrapper">
                        <canvas id="intensityChart"></canvas>
                    </div>
                </div>

                <!-- Device Preview / UI Sim -->
                <div class="glass-card p-6">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                        <h3 class="text-lg font-bold">UI System Preview</h3>
                        <div class="flex gap-2">
                            <select id="visionSim" class="bg-slate-800 text-[11px] font-bold py-1 px-3 rounded-full outline-none border border-slate-700">
                                <option value="normal">Normal Vision</option>
                                <option value="protanopia">Protanopia</option>
                                <option value="deuteranopia">Deuteranopia</option>
                                <option value="tritanopia">Tritanopia</option>
                            </select>
                        </div>
                    </div>

                    <div id="uiSimulator" class="rounded-xl bg-slate-950 p-6 sm:p-10 border border-slate-800 transition-all duration-300">
                        <div class="max-w-sm mx-auto space-y-6">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-slate-800"></div>
                                <div class="space-y-2 flex-1">
                                    <div class="h-3 w-2/3 bg-slate-800 rounded"></div>
                                    <div class="h-2 w-1/2 bg-slate-900 rounded"></div>
                                </div>
                            </div>
                            <div class="h-40 w-full rounded-2xl bg-slate-900 overflow-hidden relative" id="simHero">
                                <div class="absolute inset-0 opacity-20 bg-gradient-to-tr from-black to-transparent"></div>
                                <div class="absolute bottom-4 left-4 right-4">
                                    <div class="h-4 w-1/2 bg-white/20 rounded mb-2"></div>
                                    <div class="h-3 w-1/3 bg-white/10 rounded"></div>
                                </div>
                            </div>
                            <button id="simButton" class="w-full py-3.5 rounded-xl font-bold shadow-lg shadow-black/40">Launch Project</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- Overlay / AI Dialog -->
    <div id="modalOverlay" class="fixed inset-0 bg-[#030617]/95 z-[100] hidden items-center justify-center p-4">
        <div class="max-w-md w-full bg-slate-900 border border-slate-700 rounded-2xl p-6 sm:p-8 shadow-2xl">
            <div id="modalContent"></div>
            <button onclick="closeModal()" class="mt-6 w-full py-3 bg-slate-800 rounded-lg text-sm font-bold">Close Analysis</button>
        </div>
    </div>

    <script>
        // High-Quality Color Logic & Database
        const colorData = {
            red: {
                tags: ['Action', 'Energy', 'Passion', 'Urgency', 'Danger'],
                desc: "Physically stimulating. Red demands attention and triggers a 'fight or flight' response. In tech, it signals critical errors; in luxury, it conveys high-end passion and exclusivity.",
                cultural: [
                    { r: 'Western', m: 'Energy, Danger, Love' },
                    { r: 'East Asia', m: 'Prosperity, Luck, Marriage' },
                    { r: 'Middle East', m: 'Caution, Evil (sometimes)' },
                    { r: 'South Asia', m: 'Purity, Sacred, Fire' }
                ],
                radar: [85, 95, 70, 90, 20], // [Energy, Urgency, Luxury, Passion, Calm]
                sensitivity: "Eastern cultures view red as highly auspicious; Western uses are often more alarmist."
            },
            blue: {
                tags: ['Trust', 'Calm', 'Logic', 'Intelligence', 'Security'],
                desc: "The color of clarity and stability. Blue lowers heart rate and invites contemplation. It is the global standard for corporate professionalism and technological reliability.",
                cultural: [
                    { r: 'Western', m: 'Trust, Authority, Peace' },
                    { r: 'East Asia', m: 'Immortality, Femininity' },
                    { r: 'Middle East', m: 'Protection, Spirituality' },
                    { r: 'Africa', m: 'Peace, Harmony, Love' }
                ],
                radar: [30, 20, 75, 40, 95],
                sensitivity: "Generally the safest global color, rarely flags negative connotations."
            },
            orange: {
                tags: ['Creativity', 'Success', 'Joy', 'Friendly', 'Playful'],
                desc: "Combines red's energy with yellow's friendliness. It suggests affordability without loss of quality. Excellent for creative apps and community-focused brands.",
                cultural: [
                    { r: 'Western', m: 'Affordability, Autumn' },
                    { r: 'East Asia', m: 'Courage, Happiness' },
                    { r: 'Middle East', m: 'Mourning, Loss' },
                    { r: 'South Asia', m: 'Sacred, Saffron, Purity' }
                ],
                radar: [90, 70, 45, 80, 40],
                sensitivity: "In some Middle Eastern cultures, orange is a color of mourning."
            },
            green: {
                tags: ['Growth', 'Health', 'Stability', 'Sustainability', 'Fresh'],
                desc: "Associated with nature and renewal. In finance, it signals growth and movement. In tech, it represents 'Go' or 'System Healthy' status.",
                cultural: [
                    { r: 'Western', m: 'Money, Envy, Nature' },
                    { r: 'Middle East', m: 'Sacred, Strength, Faith' },
                    { r: 'China', m: 'Exclusivity, Wealth' },
                    { r: 'North Africa', m: 'Fertility, Life' }
                ],
                radar: [50, 40, 60, 45, 85],
                sensitivity: "In China, a 'green hat' is a negative social idiom. Use with care in headwear designs."
            }
        };

        let currentHex = "#FF8201";
        let radarChart = null;

        // Initialization
        window.addEventListener('load', () => {
            lucide.createIcons();
            initRadar();
            bindEvents();
            analyze(currentHex);
        });

        function bindEvents() {
            const picker = document.getElementById('mainColorPicker');
            const hex = document.getElementById('hexInput');
            const ind = document.getElementById('industrySelect');
            const vis = document.getElementById('visionSim');

            picker.addEventListener('input', (e) => update(e.target.value));
            hex.addEventListener('change', (e) => {
                let val = e.target.value;
                if(!val.startsWith('#')) val = '#' + val;
                if(/^#[0-9A-F]{6}$/i.test(val)) update(val);
            });
            ind.addEventListener('change', () => analyze(currentHex));
            vis.addEventListener('change', (e) => {
                const target = document.getElementById('uiSimulator');
                target.className = `rounded-xl bg-slate-950 p-6 sm:p-10 border border-slate-800 transition-all duration-300 ${e.target.value}`;
            });

            document.getElementById('aiSuggestBtn').addEventListener('click', showAIStrategy);
        }

        function update(val) {
            currentHex = val;
            document.getElementById('mainColorPicker').value = val;
            document.getElementById('hexInput').value = val;
            analyze(val);
        }

        function analyze(hex) {
            const rgb = hexToRgb(hex);
            const family = getFamily(rgb);
            const data = colorData[family] || colorData.orange;
            const industry = document.getElementById('industrySelect').value;

            // UI Updates
            updateTags(data.tags);
            updateMeaning(data.desc, industry, family);
            updateCultural(data.cultural);
            updateChart(data.radar);
            updateSim(hex);
            updateStrip(hex);
            checkContrast(hex);

            // Sensitivity Logic
            const alert = document.getElementById('sensitivityAlert');
            if(data.sensitivity) {
                alert.classList.remove('hidden');
                document.getElementById('alertText').innerText = data.sensitivity;
            } else {
                alert.classList.add('hidden');
            }
        }

        function updateTags(tags) {
            const container = document.getElementById('emotionalTags');
            container.innerHTML = tags.map(t => `<span class="px-3 py-1 rounded-full text-[10px] font-bold bg-white/5 border border-white/10 uppercase tracking-tight">${t}</span>`).join('');
        }

        function updateMeaning(desc, industry, family) {
            const box = document.getElementById('meaningDescription');
            box.innerHTML = `<p>${desc}</p>
            <div class="mt-4 pt-4 border-t border-white/5">
                <span class="text-[9px] font-black uppercase text-slate-500 tracking-widest">Industry Specifics</span>
                <p class="text-xs mt-1 italic accent-text">In ${industry} design, ${family} signals high-intensity engagement and direct communication.</p>
            </div>`;
        }

        function updateCultural(items) {
            const list = document.getElementById('culturalList');
            list.innerHTML = items.map(i => `
                <div class="flex justify-between items-center text-xs group">
                    <span class="text-slate-500 group-hover:text-slate-300 transition-colors">${i.r}</span>
                    <span class="font-medium text-slate-200">${i.m}</span>
                </div>
            `).join('');
        }

        function initRadar() {
            const ctx = document.getElementById('intensityChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Energy', 'Urgency', 'Luxury', 'Passion', 'Calm'],
                    datasets: [{
                        data: [0,0,0,0,0],
                        backgroundColor: 'rgba(255, 130, 1, 0.2)',
                        borderColor: '#FF8201',
                        borderWidth: 2,
                        pointBackgroundColor: '#FF8201',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { display: false },
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            angleLines: { color: 'rgba(255,255,255,0.05)' },
                            pointLabels: { color: '#64748b', font: { size: 10, weight: 'bold' } }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateChart(vals) {
            radarChart.data.datasets[0].data = vals;
            radarChart.update();
        }

        function updateSim(hex) {
            const btn = document.getElementById('simButton');
            const hero = document.getElementById('simHero');
            const contrast = getContrastYIQ(hex);
            
            btn.style.backgroundColor = hex;
            btn.style.color = contrast;
            hero.style.backgroundColor = adjustBrightness(hex, -30);
        }

        function updateStrip(hex) {
            const strip = document.getElementById('paletteStrip');
            const shades = [
                adjustBrightness(hex, -40),
                adjustBrightness(hex, -20),
                hex,
                adjustBrightness(hex, 20),
                adjustBrightness(hex, 40)
            ];
            strip.innerHTML = shades.map(s => `<div style="background-color: ${s}; flex: 1"></div>`).join('');
        }

        function checkContrast(hex) {
            const rgb = hexToRgb(hex);
            const luma = 0.2126 * rgb.r + 0.7152 * rgb.g + 0.0722 * rgb.b; 
            const status = document.getElementById('accessibilityCheck');
            const isGood = luma < 180 && luma > 40; // General safe range for white text
            
            status.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-xs text-slate-500">Contrast Score</span>
                    <span class="px-2 py-0.5 rounded text-[10px] font-bold ${isGood ? 'bg-green-500/10 text-green-400' : 'bg-amber-500/10 text-amber-400'}">
                        ${isGood ? 'OPTIMAL' : 'REVIEW'}
                    </span>
                </div>
            `;
        }

        function showAIStrategy() {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            content.innerHTML = `
                <div class="text-center">
                    <div class="w-12 h-12 bg-orange-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="zap" class="text-orange-500 w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Strategy: Digital Energy</h3>
                    <p class="text-slate-400 text-sm mb-6">Based on ${currentHex}, we suggest pairing this with deep slates (#1E293B) and high-contrast whites to maintain accessibility while preserving visual impact.</p>
                    <div class="flex gap-2 justify-center">
                        <div class="w-8 h-8 rounded bg-[#1e293b]"></div>
                        <div class="w-8 h-8 rounded bg-white"></div>
                        <div class="w-8 h-8 rounded bg-slate-600"></div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
            document.getElementById('modalOverlay').classList.remove('flex');
        }

        async function exportReport() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('captureArea');
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>`;
            lucide.createIcons();

            const canvas = await html2canvas(element, { backgroundColor: '#030617', scale: 1.5 });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const width = pdf.internal.pageSize.getWidth();
            const height = (canvas.height * width) / canvas.width;
            
            pdf.addImage(imgData, 'PNG', 0, 0, width, height);
            pdf.save(`KromaMind-Spec-${currentHex}.pdf`);
            
            btn.innerHTML = originalText;
            lucide.createIcons();
        }

        // Utils
        function hexToRgb(hex) {
            const res = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return res ? { r: parseInt(res[1],16), g: parseInt(res[2],16), b: parseInt(res[3],16) } : null;
        }

        function getFamily(rgb) {
            if (rgb.r > rgb.g && rgb.r > rgb.b) {
                return (rgb.g > 100) ? 'orange' : 'red';
            }
            if (rgb.b > rgb.r && rgb.b > rgb.g) return 'blue';
            if (rgb.g > rgb.r && rgb.g > rgb.b) return 'green';
            return 'blue';
        }

        function adjustBrightness(hex, p) {
            const rgb = hexToRgb(hex);
            const r = Math.min(255, Math.max(0, rgb.r + (rgb.r * (p / 100))));
            const g = Math.min(255, Math.max(0, rgb.g + (rgb.g * (p / 100))));
            const b = Math.min(255, Math.max(0, rgb.b + (rgb.b * (p / 100))));
            return `#${Math.round(r).toString(16).padStart(2,'0')}${Math.round(g).toString(16).padStart(2,'0')}${Math.round(b).toString(16).padStart(2,'0')}`;
        }

        function getContrastYIQ(hex){
            const rgb = hexToRgb(hex);
            return ((rgb.r*299+rgb.g*587+rgb.b*114)/1000) >= 128 ? 'black' : 'white';
        }
    </script>
</body>
</html>
